#
# script for using gocov
# see: https://github.com/axw/gocov
#

if [ "$1" == "" -o "$2" == "" -o "$3" == "" -o "$4" == "" ]
then
  echo
  echo usage: cov "<package> --ceiling <nn> <regex-to-filter-functions>"
  echo
  echo Run this script from the package folder.
  echo
else
  echo === Deleting existing logfiles...
  if [ -d covdata ]
  then
    if [ -f covdata/coverage.json ]
    then
      rm covdata/coverage.json
    fi
    if [ -f covdata/coverage.log ]
    then
      rm covdata/coverage.log
    fi
    if [ -f covdata/coverage-annotate.log ]
    then
      rm covdata/coverage-annotate.log
    fi
  else
    mkdir covdata; chmod 777 covdata
  fi
  echo === Gathering coverage info...
  gocov test $1 > covdata/coverage.json
  echo === Creating summary report...
  gocov report covdata/coverage.json > covdata/coverage.log
  echo === Annotating source code...
  gocov annotate covdata/coverage.json $2 $3 $4 > covdata/coverage-annotate.log
  echo "=== Done!"
fi
