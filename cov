#
# usage: cov <package> <logfile-prefix>
# examples:
#		cov . gohg
#		cov gohg gohg
#

echo === Deleting existing logfiles...
if [ -d data ]
then
  if [ -f data/$2-coverage.json ]
  then
    rm data/$2-coverage.json
  fi
  if [ -f data/$2-coverage.log ]
  then
    rm data/$2-coverage.log
  fi
  if [ -f data/$2-coverage-annotate.log ]
  then
    rm data/$2-coverage-annotate.log
  fi
  goto new
else
  mkdir data; chmod 777 data
fi
:new
echo === Gathering coverage info...
gocov test $1 > data/$2-coverage.json
echo === Creating logfile...
gocov report data/$2-coverage.json > data/$2-coverage.log
echo === Annotating functions...
gocov annotate data/$2-coverage.json .* > data/$2-coverage-annotate.log
echo "=== Done!"

